# Занятие №4: Установка PostgreSQL

-   сделать в GCE инстанс с Ubuntu 20.04  
**Выполнение этапа:** создал инстанс instance-3 с CentOS 8
-   поставить на нем Docker Engine  
**Выполнение этапа:** docker поставился без проблем (dnf install docker-ce). Из нового, что с docker я раньше встречался только на CentOS 7, а в CentOS 8 ушли от iptables в сторону nftables, с которым docker не умеет работать. К счастью, гугл подсказал, что делать:  
firewall-cmd --zone=public --add-masquerade --permanent  
firewall-cmd --reload
-   сделать каталог /var/lib/postgres
-   развернуть контейнер с PostgreSQL 13 смонтировав в него /var/lib/postgres  
**Выполнение этапа:** развернул контейнер с PostgreSQL 14, без проблем  
-   развернуть контейнер с клиентом postgres  
**Выполнение этапа:** так же без проблем
-   подключится из контейнера с клиентом к контейнеру с сервером и сделать
таблицу с парой строк  
**Выполнение этапа:** Создал таблицу test, записал туда 4 строки.
-   подключится к контейнеру с сервером с ноутбука/компьютера извне инстансов GCP  
**Выполнение этапа:** Вот тут с ходу не получилось подключиться. Оказалось, в firewall в Google Cloud нужно было разрешить трафик на порт 5432. После добавления правила успешно подключился.
-   удалить контейнер с сервером
-   создать его заново
-   подключится снова из контейнера с клиентом к контейнеру с сервером
-   проверить, что данные остались на месте  
**Выполнение этапа:** в новом контейнере присуствует созданная ранее таблица, как и все данные в ней, т.к. сам каталог с БД в обоих случаях монтируется в контейнер из одного и того же места.
